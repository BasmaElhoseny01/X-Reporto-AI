New 5-day Log started at 2024-03-11 

2024-03-11 03:16:49,975 - INFO - =================== New Run Started: 2024-03-11 03:16:49 ===================
2024-03-11 03:16:49,976 - INFO - Training X_Reporto Started
2024-03-11 03:16:49,976 - INFO - DEVICE: cuda
2024-03-11 03:16:49,976 - INFO - OPERATION_MODE: 1
2024-03-11 03:16:49,977 - INFO - MODEL_STAGE: 3
2024-03-11 03:16:49,977 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:16:49,977 - INFO - TRAIN_RPN: False
2024-03-11 03:16:49,978 - INFO - TRAIN_ROI: False
2024-03-11 03:16:49,978 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:16:49,978 - INFO - RUN: 5
2024-03-11 03:16:49,979 - INFO - EPOCHS: 6
2024-03-11 03:16:49,979 - INFO - BATCH_SIZE: 1
2024-03-11 03:16:49,979 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:16:49,980 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:16:49,980 - INFO - LM_Batch_Size: 1
2024-03-11 03:16:49,980 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:16:49,981 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:16:49,981 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:16:49,981 - INFO - DEBUG: True
2024-03-11 03:16:49,982 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:16:49,982 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:16:49,982 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:16:49,983 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:16:49,983 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:16:49,983 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:16:49,984 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:16:49,984 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:16:49,984 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:16:49,984 - INFO - RECOVER: False
2024-03-11 03:16:49,985 - INFO - Folder 'models/5' created successfully.
2024-03-11 03:16:49,985 - INFO - Folder 'check_points/5' created successfully.
2024-03-11 03:16:49,986 - INFO - Folder './tensor_boards/5/train_2024-03-11_03-16-49' created successfully.
2024-03-11 03:16:54,720 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:16:55,315 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:16:55,471 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:16:58,237 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:16:58,260 - INFO - Loading object_detector .....
2024-03-11 03:16:58,261 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 503, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 457, in main
    x_reporto_model = XReporto().create_model()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_factory.py", line 8, in create_model
    return XReportoV1()
           ^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 113, in __init__
    load_model(model=self.object_detector,name='object_detector_best')
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\utils.py", line 322, in load_model
    model.load_state_dict(torch.load("models/" + str(RUN) + '/' + name + ".pth"))
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\serialization.py", line 998, in load
    with _open_file_like(f, 'rb') as opened_file:
         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\serialization.py", line 445, in _open_file_like
    return _open_file(name_or_buffer, mode)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\serialization.py", line 426, in __init__
    super().__init__(open(name, mode))
                     ^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'models/5/object_detector_best.pth'
2024-03-11 03:17:29,932 - INFO - =================== New Run Started: 2024-03-11 03:17:29 ===================
2024-03-11 03:17:29,933 - INFO - Training X_Reporto Started
2024-03-11 03:17:29,933 - INFO - DEVICE: cuda
2024-03-11 03:17:29,933 - INFO - OPERATION_MODE: 1
2024-03-11 03:17:29,934 - INFO - MODEL_STAGE: 3
2024-03-11 03:17:29,934 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:17:29,934 - INFO - TRAIN_RPN: False
2024-03-11 03:17:29,934 - INFO - TRAIN_ROI: False
2024-03-11 03:17:29,935 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:17:29,935 - INFO - RUN: 0
2024-03-11 03:17:29,935 - INFO - EPOCHS: 6
2024-03-11 03:17:29,935 - INFO - BATCH_SIZE: 1
2024-03-11 03:17:29,935 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:17:29,935 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:17:29,936 - INFO - LM_Batch_Size: 1
2024-03-11 03:17:29,936 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:17:29,936 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:17:29,936 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:17:29,936 - INFO - DEBUG: True
2024-03-11 03:17:29,937 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:17:29,937 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:17:29,937 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:17:29,937 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:17:29,938 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:17:29,938 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:17:29,938 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:17:29,939 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:17:29,939 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:17:29,939 - INFO - RECOVER: False
2024-03-11 03:17:29,940 - INFO - Folder 'models/0' already exists.
2024-03-11 03:17:29,940 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:17:29,941 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-17-29' created successfully.
2024-03-11 03:17:34,649 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:17:35,264 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:17:35,471 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:17:37,566 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:17:37,589 - INFO - Loading object_detector .....
2024-03-11 03:17:38,926 - INFO - All object_detector paramets are Frozen
2024-03-11 03:17:38,927 - INFO - Loading region_classifier .....
2024-03-11 03:17:38,935 - INFO - Loading abnormal_classifier .....
2024-03-11 03:17:39,904 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:17:39,997 - INFO - Train dataset loaded
2024-03-11 03:17:40,229 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:17:40,296 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 503, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 464, in main
    trainer = XReportoTrainer(model=x_reporto_model,tensor_board_writer=tensor_board_writer)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 96, in __init__
    self.dataset_val = CustomDataset(dataset_path= validation_csv_path, transform_type='val')
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\data_loader\custom_dataset.py", line 27, in __init__
    self.data_info = pd.read_csv(dataset_path, header=None)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\pandas\io\parsers\readers.py", line 948, in read_csv
    return _read(filepath_or_buffer, kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\pandas\io\parsers\readers.py", line 611, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\pandas\io\parsers\readers.py", line 1448, in __init__
    self._engine = self._make_engine(f, self.engine)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\pandas\io\parsers\readers.py", line 1705, in _make_engine
    self.handles = get_handle(
                   ^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\pandas\io\common.py", line 863, in get_handle
    handle = open(
             ^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'datasets/valid-100.csv'
2024-03-11 03:18:08,497 - INFO - =================== New Run Started: 2024-03-11 03:18:08 ===================
2024-03-11 03:18:08,498 - INFO - Training X_Reporto Started
2024-03-11 03:18:08,498 - INFO - DEVICE: cuda
2024-03-11 03:18:08,498 - INFO - OPERATION_MODE: 1
2024-03-11 03:18:08,499 - INFO - MODEL_STAGE: 3
2024-03-11 03:18:08,499 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:18:08,499 - INFO - TRAIN_RPN: False
2024-03-11 03:18:08,499 - INFO - TRAIN_ROI: False
2024-03-11 03:18:08,499 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:18:08,500 - INFO - RUN: 0
2024-03-11 03:18:08,500 - INFO - EPOCHS: 6
2024-03-11 03:18:08,500 - INFO - BATCH_SIZE: 1
2024-03-11 03:18:08,500 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:18:08,500 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:18:08,501 - INFO - LM_Batch_Size: 1
2024-03-11 03:18:08,501 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:18:08,501 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:18:08,501 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:18:08,501 - INFO - DEBUG: True
2024-03-11 03:18:08,502 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:18:08,502 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:18:08,502 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:18:08,502 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:18:08,502 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:18:08,503 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:18:08,503 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:18:08,503 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:18:08,503 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:18:08,503 - INFO - RECOVER: False
2024-03-11 03:18:08,503 - INFO - Folder 'models/0' already exists.
2024-03-11 03:18:08,504 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:18:08,504 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-18-08' created successfully.
2024-03-11 03:18:13,263 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:18:13,794 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:18:13,945 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:18:17,811 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:18:17,839 - INFO - Loading object_detector .....
2024-03-11 03:18:19,764 - INFO - All object_detector paramets are Frozen
2024-03-11 03:18:19,765 - INFO - Loading region_classifier .....
2024-03-11 03:18:19,775 - INFO - Loading abnormal_classifier .....
2024-03-11 03:18:20,809 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:18:20,903 - INFO - Train dataset loaded
2024-03-11 03:18:21,061 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:18:21,141 - INFO - Validation dataset loaded
2024-03-11 03:18:21,142 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:18:21,142 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:18:21,143 - INFO - Start Training
2024-03-11 03:19:20,335 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 503, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 492, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 168, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: XReportoTrainer.language_model_forward_pass() missing 2 required positional arguments: 'epoch' and 'batch_idx'
2024-03-11 03:24:45,259 - INFO - =================== New Run Started: 2024-03-11 03:24:45 ===================
2024-03-11 03:24:45,260 - INFO - Training X_Reporto Started
2024-03-11 03:24:45,260 - INFO - DEVICE: cuda
2024-03-11 03:24:45,261 - INFO - OPERATION_MODE: 1
2024-03-11 03:24:45,261 - INFO - MODEL_STAGE: 3
2024-03-11 03:24:45,261 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:24:45,262 - INFO - TRAIN_RPN: False
2024-03-11 03:24:45,262 - INFO - TRAIN_ROI: False
2024-03-11 03:24:45,262 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:24:45,262 - INFO - RUN: 0
2024-03-11 03:24:45,262 - INFO - EPOCHS: 6
2024-03-11 03:24:45,263 - INFO - BATCH_SIZE: 1
2024-03-11 03:24:45,263 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:24:45,263 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:24:45,263 - INFO - LM_Batch_Size: 1
2024-03-11 03:24:45,263 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:24:45,264 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:24:45,264 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:24:45,264 - INFO - DEBUG: True
2024-03-11 03:24:45,264 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:24:45,264 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:24:45,265 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:24:45,265 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:24:45,265 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:24:45,265 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:24:45,265 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:24:45,266 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:24:45,266 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:24:45,266 - INFO - RECOVER: False
2024-03-11 03:24:45,266 - INFO - Folder 'models/0' already exists.
2024-03-11 03:24:45,267 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:24:45,267 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-24-45' created successfully.
2024-03-11 03:24:50,205 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:24:50,800 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:24:50,989 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:24:53,195 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:24:53,206 - INFO - Loading object_detector .....
2024-03-11 03:24:54,252 - INFO - All object_detector paramets are Frozen
2024-03-11 03:24:54,252 - INFO - Loading region_classifier .....
2024-03-11 03:24:54,262 - INFO - Loading abnormal_classifier .....
2024-03-11 03:24:55,192 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:24:55,293 - INFO - Train dataset loaded
2024-03-11 03:24:55,451 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:24:55,531 - INFO - Validation dataset loaded
2024-03-11 03:24:55,532 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:24:55,532 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:24:55,533 - INFO - Start Training
2024-03-11 03:25:47,787 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 504, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 493, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,batch=batch,index=i,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: XReportoV1.forward() got an unexpected keyword argument 'LM_targets'
2024-03-11 03:32:12,341 - INFO - =================== New Run Started: 2024-03-11 03:32:12 ===================
2024-03-11 03:32:12,341 - INFO - Training X_Reporto Started
2024-03-11 03:32:12,341 - INFO - DEVICE: cuda
2024-03-11 03:32:12,341 - INFO - OPERATION_MODE: 1
2024-03-11 03:32:12,342 - INFO - MODEL_STAGE: 3
2024-03-11 03:32:12,342 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:32:12,342 - INFO - TRAIN_RPN: False
2024-03-11 03:32:12,342 - INFO - TRAIN_ROI: False
2024-03-11 03:32:12,343 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:32:12,343 - INFO - RUN: 0
2024-03-11 03:32:12,343 - INFO - EPOCHS: 6
2024-03-11 03:32:12,343 - INFO - BATCH_SIZE: 1
2024-03-11 03:32:12,344 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:32:12,344 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:32:12,344 - INFO - LM_Batch_Size: 1
2024-03-11 03:32:12,344 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:32:12,345 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:32:12,345 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:32:12,345 - INFO - DEBUG: True
2024-03-11 03:32:12,345 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:32:12,345 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:32:12,346 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:32:12,346 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:32:12,346 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:32:12,346 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:32:12,346 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:32:12,347 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:32:12,347 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:32:12,347 - INFO - RECOVER: False
2024-03-11 03:32:12,347 - INFO - Folder 'models/0' already exists.
2024-03-11 03:32:12,347 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:32:12,348 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-32-12' created successfully.
2024-03-11 03:32:17,108 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:32:17,696 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:32:17,856 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:32:19,970 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:32:19,985 - INFO - Loading object_detector .....
2024-03-11 03:32:21,053 - INFO - All object_detector paramets are Frozen
2024-03-11 03:32:21,053 - INFO - Loading region_classifier .....
2024-03-11 03:32:21,062 - INFO - Loading abnormal_classifier .....
2024-03-11 03:32:22,080 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:32:22,171 - INFO - Train dataset loaded
2024-03-11 03:32:22,327 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:32:22,401 - INFO - Validation dataset loaded
2024-03-11 03:32:22,401 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:32:22,402 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:32:22,402 - INFO - Start Training
2024-03-11 03:33:19,553 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7242 selection_classifier_Loss: 1.1132 abnormal_classifier_Loss: 1.3952 LM_losses: 270.5728 total_Loss: 275.8054
2024-03-11 03:33:20,067 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8204 selection_classifier_Loss: 1.0887 abnormal_classifier_Loss: 1.3941 LM_losses: 579.8976 total_Loss: 585.2007
2024-03-11 03:33:20,711 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7205 selection_classifier_Loss: 1.0872 abnormal_classifier_Loss: 1.3916 LM_losses: 896.2028 total_Loss: 901.4021
2024-03-11 03:33:21,367 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8014 selection_classifier_Loss: 1.0984 abnormal_classifier_Loss: 1.3985 LM_losses: 1206.4701 total_Loss: 1211.7684
2024-03-11 03:33:22,062 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7318 selection_classifier_Loss: 1.1059 abnormal_classifier_Loss: 1.3949 LM_losses: 1516.1539 total_Loss: 1521.3866
2024-03-11 03:33:23,368 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7658 selection_classifier_Loss: 1.0873 abnormal_classifier_Loss: 1.3916 LM_losses: 1944.3842 total_Loss: 1949.6288
2024-03-11 03:33:25,070 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7528 selection_classifier_Loss: 1.0885 abnormal_classifier_Loss: 1.3878 LM_losses: 2241.0720 total_Loss: 2246.3010
2024-03-11 03:33:25,663 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8152 selection_classifier_Loss: 1.1048 abnormal_classifier_Loss: 1.3987 LM_losses: 2551.8628 total_Loss: 2557.1816
2024-03-11 03:33:27,834 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 504, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 493, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 329, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 5.13 GiB is allocated by PyTorch, and 84.31 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 03:34:59,409 - INFO - =================== New Run Started: 2024-03-11 03:34:59 ===================
2024-03-11 03:34:59,409 - INFO - Training X_Reporto Started
2024-03-11 03:34:59,409 - INFO - DEVICE: cuda
2024-03-11 03:34:59,409 - INFO - OPERATION_MODE: 1
2024-03-11 03:34:59,410 - INFO - MODEL_STAGE: 3
2024-03-11 03:34:59,410 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:34:59,410 - INFO - TRAIN_RPN: False
2024-03-11 03:34:59,410 - INFO - TRAIN_ROI: False
2024-03-11 03:34:59,410 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:34:59,410 - INFO - RUN: 0
2024-03-11 03:34:59,411 - INFO - EPOCHS: 6
2024-03-11 03:34:59,411 - INFO - BATCH_SIZE: 1
2024-03-11 03:34:59,411 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:34:59,411 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:34:59,411 - INFO - LM_Batch_Size: 1
2024-03-11 03:34:59,412 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:34:59,412 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:34:59,412 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:34:59,412 - INFO - DEBUG: True
2024-03-11 03:34:59,412 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:34:59,413 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:34:59,413 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:34:59,413 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:34:59,413 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:34:59,414 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:34:59,414 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:34:59,414 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:34:59,414 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:34:59,414 - INFO - RECOVER: False
2024-03-11 03:34:59,415 - INFO - Folder 'models/0' already exists.
2024-03-11 03:34:59,415 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:34:59,415 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-34-59' created successfully.
2024-03-11 03:35:04,409 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:35:04,955 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:35:05,110 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:35:07,357 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/generation_config.json HTTP/1.1" 404 0
2024-03-11 03:35:07,373 - INFO - Loading object_detector .....
2024-03-11 03:35:08,441 - INFO - All object_detector paramets are Frozen
2024-03-11 03:35:08,441 - INFO - Loading region_classifier .....
2024-03-11 03:35:08,451 - INFO - Loading abnormal_classifier .....
2024-03-11 03:35:09,362 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:35:09,448 - INFO - Train dataset loaded
2024-03-11 03:35:09,719 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:35:09,803 - INFO - Validation dataset loaded
2024-03-11 03:35:09,804 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:35:09,805 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:35:09,805 - INFO - Start Training
2024-03-11 03:36:09,848 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7639 selection_classifier_Loss: 1.0872 abnormal_classifier_Loss: 1.3916 LM_losses: 137.0232 total_Loss: 142.2659
2024-03-11 03:36:10,354 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7864 selection_classifier_Loss: 1.0858 abnormal_classifier_Loss: 1.3988 LM_losses: 305.5671 total_Loss: 310.8381
2024-03-11 03:36:10,865 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7113 selection_classifier_Loss: 1.0904 abnormal_classifier_Loss: 1.3907 LM_losses: 459.4473 total_Loss: 464.6397
2024-03-11 03:36:11,372 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7596 selection_classifier_Loss: 1.0855 abnormal_classifier_Loss: 1.4038 LM_losses: 634.2242 total_Loss: 639.4731
2024-03-11 03:36:11,917 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7971 selection_classifier_Loss: 1.1048 abnormal_classifier_Loss: 1.3987 LM_losses: 761.4588 total_Loss: 766.7594
2024-03-11 03:36:12,582 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7518 selection_classifier_Loss: 1.1115 abnormal_classifier_Loss: 1.3946 LM_losses: 902.4363 total_Loss: 907.6941
2024-03-11 03:36:13,538 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6806 selection_classifier_Loss: 1.0898 abnormal_classifier_Loss: 1.3936 LM_losses: 1041.5535 total_Loss: 1046.7175
2024-03-11 03:36:14,101 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7578 selection_classifier_Loss: 1.1048 abnormal_classifier_Loss: 1.3987 LM_losses: 1165.9697 total_Loss: 1171.2311
2024-03-11 03:36:16,298 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 504, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 493, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 329, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 5.13 GiB is allocated by PyTorch, and 84.31 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 03:37:38,596 - INFO - =================== New Run Started: 2024-03-11 03:37:38 ===================
2024-03-11 03:37:38,597 - INFO - Training X_Reporto Started
2024-03-11 03:37:38,597 - INFO - DEVICE: cuda
2024-03-11 03:37:38,597 - INFO - OPERATION_MODE: 1
2024-03-11 03:37:38,597 - INFO - MODEL_STAGE: 3
2024-03-11 03:37:38,598 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:37:38,598 - INFO - TRAIN_RPN: False
2024-03-11 03:37:38,598 - INFO - TRAIN_ROI: False
2024-03-11 03:37:38,598 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:37:38,599 - INFO - RUN: 0
2024-03-11 03:37:38,599 - INFO - EPOCHS: 6
2024-03-11 03:37:38,599 - INFO - BATCH_SIZE: 1
2024-03-11 03:37:38,599 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:37:38,600 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:37:38,600 - INFO - LM_Batch_Size: 1
2024-03-11 03:37:38,600 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:37:38,600 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:37:38,600 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:37:38,601 - INFO - DEBUG: True
2024-03-11 03:37:38,601 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:37:38,601 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:37:38,601 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:37:38,602 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:37:38,602 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:37:38,602 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:37:38,602 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:37:38,602 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:37:38,602 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:37:38,603 - INFO - RECOVER: False
2024-03-11 03:37:38,603 - INFO - Folder 'models/0' already exists.
2024-03-11 03:37:38,603 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:37:38,604 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-37-38' created successfully.
2024-03-11 03:52:15,373 - INFO - =================== New Run Started: 2024-03-11 03:52:15 ===================
2024-03-11 03:52:15,373 - INFO - Training X_Reporto Started
2024-03-11 03:52:15,373 - INFO - DEVICE: cuda
2024-03-11 03:52:15,374 - INFO - OPERATION_MODE: 1
2024-03-11 03:52:15,374 - INFO - MODEL_STAGE: 3
2024-03-11 03:52:15,374 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:52:15,374 - INFO - TRAIN_RPN: False
2024-03-11 03:52:15,375 - INFO - TRAIN_ROI: False
2024-03-11 03:52:15,375 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:52:15,375 - INFO - RUN: 0
2024-03-11 03:52:15,375 - INFO - EPOCHS: 6
2024-03-11 03:52:15,375 - INFO - BATCH_SIZE: 1
2024-03-11 03:52:15,376 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:52:15,376 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:52:15,376 - INFO - LM_Batch_Size: 1
2024-03-11 03:52:15,376 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:52:15,376 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:52:15,376 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:52:15,377 - INFO - DEBUG: True
2024-03-11 03:52:15,377 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:52:15,377 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:52:15,377 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:52:15,377 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:52:15,378 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:52:15,378 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:52:15,378 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:52:15,378 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:52:15,378 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:52:15,378 - INFO - RECOVER: False
2024-03-11 03:52:15,379 - INFO - Folder 'models/0' already exists.
2024-03-11 03:52:15,379 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:52:15,379 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-52-15' created successfully.
2024-03-11 03:52:18,258 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:52:19,038 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:52:19,211 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:52:20,506 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 03:52:20,549 - INFO - Loading object_detector .....
2024-03-11 03:52:21,732 - INFO - All object_detector paramets are Frozen
2024-03-11 03:52:21,732 - INFO - Loading region_classifier .....
2024-03-11 03:52:21,740 - INFO - Loading abnormal_classifier .....
2024-03-11 03:52:22,282 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:52:22,378 - INFO - Train dataset loaded
2024-03-11 03:52:22,531 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:52:22,601 - INFO - Validation dataset loaded
2024-03-11 03:52:22,602 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:52:22,602 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:52:22,603 - INFO - Start Training
2024-03-11 03:53:19,710 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6842 selection_classifier_Loss: 1.1144 abnormal_classifier_Loss: 1.3938 LM_losses: 118.0936 total_Loss: 123.2859
2024-03-11 03:53:20,505 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7549 selection_classifier_Loss: 1.0982 abnormal_classifier_Loss: 1.3901 LM_losses: 236.3234 total_Loss: 241.5666
2024-03-11 03:53:20,888 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7988 selection_classifier_Loss: 1.1200 abnormal_classifier_Loss: 1.4537 LM_losses: 350.0576 total_Loss: 355.4300
2024-03-11 03:53:21,258 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7730 selection_classifier_Loss: 1.1060 abnormal_classifier_Loss: 1.3940 LM_losses: 456.4974 total_Loss: 461.7704
2024-03-11 03:53:21,655 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7418 selection_classifier_Loss: 1.0957 abnormal_classifier_Loss: 1.3889 LM_losses: 558.3804 total_Loss: 563.6069
2024-03-11 03:53:22,068 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7619 selection_classifier_Loss: 1.1044 abnormal_classifier_Loss: 1.3928 LM_losses: 659.5232 total_Loss: 664.7823
2024-03-11 03:53:22,439 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7123 selection_classifier_Loss: 1.0874 abnormal_classifier_Loss: 1.4038 LM_losses: 798.8089 total_Loss: 804.0125
2024-03-11 03:53:22,859 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7437 selection_classifier_Loss: 1.0776 abnormal_classifier_Loss: 1.3803 LM_losses: 912.8594 total_Loss: 918.0610
2024-03-11 03:53:23,285 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7410 selection_classifier_Loss: 1.0946 abnormal_classifier_Loss: 1.4012 LM_losses: 1049.9178 total_Loss: 1055.1545
2024-03-11 03:53:23,833 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 03:53:23,833 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0004000000
2024-03-11 03:53:24,532 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5248 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: 74.7070 total_Loss: 83.8818
2024-03-11 03:53:24,921 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4617 selection_classifier_Loss: 1.7410 abnormal_classifier_Loss: 4.9299 LM_losses: 149.2164 total_Loss: 158.3489
2024-03-11 03:53:25,332 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4939 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: 227.7519 total_Loss: 236.8959
2024-03-11 03:53:25,745 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5251 selection_classifier_Loss: 1.7432 abnormal_classifier_Loss: 4.9242 LM_losses: 301.2173 total_Loss: 310.4098
2024-03-11 03:53:26,222 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5145 selection_classifier_Loss: 1.7067 abnormal_classifier_Loss: 4.8590 LM_losses: 374.1873 total_Loss: 383.2674
2024-03-11 03:53:26,667 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4748 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 451.3548 total_Loss: 460.4899
2024-03-11 03:53:27,486 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5158 selection_classifier_Loss: 1.7252 abnormal_classifier_Loss: 4.9184 LM_losses: 529.9879 total_Loss: 539.1472
2024-03-11 03:53:27,917 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5190 selection_classifier_Loss: 1.7406 abnormal_classifier_Loss: 4.8930 LM_losses: 603.2014 total_Loss: 612.3541
2024-03-11 03:53:29,832 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 505, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 494, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 347, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.88 GiB is allocated by PyTorch, and 314.29 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 03:56:42,039 - INFO - =================== New Run Started: 2024-03-11 03:56:42 ===================
2024-03-11 03:56:42,040 - INFO - Training X_Reporto Started
2024-03-11 03:56:42,040 - INFO - DEVICE: cuda
2024-03-11 03:56:42,041 - INFO - OPERATION_MODE: 1
2024-03-11 03:56:42,041 - INFO - MODEL_STAGE: 3
2024-03-11 03:56:42,041 - INFO - CONTINUE_TRAIN: False
2024-03-11 03:56:42,041 - INFO - TRAIN_RPN: False
2024-03-11 03:56:42,041 - INFO - TRAIN_ROI: False
2024-03-11 03:56:42,042 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 03:56:42,042 - INFO - RUN: 0
2024-03-11 03:56:42,042 - INFO - EPOCHS: 6
2024-03-11 03:56:42,042 - INFO - BATCH_SIZE: 1
2024-03-11 03:56:42,043 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 03:56:42,043 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 03:56:42,043 - INFO - LM_Batch_Size: 1
2024-03-11 03:56:42,043 - INFO - LEARNING_RATE: 0.0004
2024-03-11 03:56:42,044 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 03:56:42,044 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 03:56:42,044 - INFO - DEBUG: True
2024-03-11 03:56:42,044 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 03:56:42,045 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 03:56:42,045 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 03:56:42,045 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:56:42,045 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 03:56:42,046 - INFO - training_csv_path: datasets/train.csv
2024-03-11 03:56:42,046 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 03:56:42,046 - INFO - PERIODIC_LOGGING: True
2024-03-11 03:56:42,046 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 03:56:42,047 - INFO - RECOVER: False
2024-03-11 03:56:42,047 - INFO - Folder 'models/0' already exists.
2024-03-11 03:56:42,047 - INFO - Folder 'check_points/0' already exists.
2024-03-11 03:56:42,048 - INFO - Folder './tensor_boards/0/train_2024-03-11_03-56-42' created successfully.
2024-03-11 03:56:45,407 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 03:56:46,202 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:56:46,418 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 03:56:47,847 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 03:56:47,894 - INFO - Loading object_detector .....
2024-03-11 03:56:49,214 - INFO - All object_detector paramets are Frozen
2024-03-11 03:56:49,215 - INFO - Loading region_classifier .....
2024-03-11 03:56:49,223 - INFO - Loading abnormal_classifier .....
2024-03-11 03:56:49,798 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:56:49,881 - INFO - Train dataset loaded
2024-03-11 03:56:50,220 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 03:56:50,282 - INFO - Validation dataset loaded
2024-03-11 03:56:50,282 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 03:56:50,283 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 03:56:50,283 - INFO - Start Training
2024-03-11 03:57:51,142 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7665 selection_classifier_Loss: 1.0842 abnormal_classifier_Loss: 1.3889 LM_losses: 134.7687 total_Loss: 140.0083
2024-03-11 03:57:53,084 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 506, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 495, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 307, in forward
    object_detector_losses,object_detector_boxes,object_detector_detected_classes,object_detector_features = self.object_detector(images=images, targets=object_detector_targets)
                                                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\object_detector_factory.py", line 78, in forward
    object_detector_losses, object_detector_predictions =self.object_detector(images,targets)
                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\frccn_object_detector_v1.py", line 208, in forward
    proposals, proposal_losses = self.rpn(images, features, targets)
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\rpn.py", line 84, in forward
    labels, matched_gt_boxes = self.assign_targets_to_anchors(anchors, targets)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\models\detection\rpn.py", line 207, in assign_targets_to_anchors
    match_quality_matrix = self.box_similarity(gt_boxes, anchors_per_image)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 271, in box_iou
    inter, union = _box_inter_union(boxes1, boxes2)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 244, in _box_inter_union
    lt = torch.max(boxes1[:, None, :2], boxes2[:, :2])  # [N,M,2]
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!
2024-03-11 04:53:01,711 - INFO - =================== New Run Started: 2024-03-11 04:53:01 ===================
2024-03-11 04:53:01,712 - INFO - Training X_Reporto Started
2024-03-11 04:53:01,712 - INFO - DEVICE: cuda
2024-03-11 04:53:01,712 - INFO - OPERATION_MODE: 1
2024-03-11 04:53:01,713 - INFO - MODEL_STAGE: 3
2024-03-11 04:53:01,713 - INFO - CONTINUE_TRAIN: False
2024-03-11 04:53:01,713 - INFO - TRAIN_RPN: False
2024-03-11 04:53:01,713 - INFO - TRAIN_ROI: False
2024-03-11 04:53:01,713 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 04:53:01,714 - INFO - RUN: 0
2024-03-11 04:53:01,714 - INFO - EPOCHS: 6
2024-03-11 04:53:01,714 - INFO - BATCH_SIZE: 1
2024-03-11 04:53:01,714 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 04:53:01,714 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 04:53:01,715 - INFO - LM_Batch_Size: 1
2024-03-11 04:53:01,715 - INFO - LEARNING_RATE: 0.0004
2024-03-11 04:53:01,715 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 04:53:01,715 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 04:53:01,715 - INFO - DEBUG: True
2024-03-11 04:53:01,715 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 04:53:01,716 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 04:53:01,716 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 04:53:01,716 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:53:01,717 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:53:01,717 - INFO - training_csv_path: datasets/train.csv
2024-03-11 04:53:01,717 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 04:53:01,718 - INFO - PERIODIC_LOGGING: True
2024-03-11 04:53:01,718 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 04:53:01,718 - INFO - RECOVER: False
2024-03-11 04:53:01,718 - INFO - Folder 'models/0' already exists.
2024-03-11 04:53:01,718 - INFO - Folder 'check_points/0' already exists.
2024-03-11 04:53:01,719 - INFO - Folder './tensor_boards/0/train_2024-03-11_04-53-01' created successfully.
2024-03-11 04:53:04,905 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 04:53:05,501 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:53:05,668 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:53:07,290 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 04:53:07,343 - INFO - Loading object_detector .....
2024-03-11 04:53:08,648 - INFO - All object_detector paramets are Frozen
2024-03-11 04:53:08,649 - INFO - Loading region_classifier .....
2024-03-11 04:53:08,661 - INFO - Loading abnormal_classifier .....
2024-03-11 04:53:09,285 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:53:09,377 - INFO - Train dataset loaded
2024-03-11 04:53:09,527 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:53:09,613 - INFO - Validation dataset loaded
2024-03-11 04:53:09,614 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 04:53:09,615 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 04:53:09,615 - INFO - Start Training
2024-03-11 04:54:03,616 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 505, in <module>
    try:
        ^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 494, in main
    # No check point
    ^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 316, in language_model_forward_pass
    logging.debug(f'images.device: {images.device}')
                                                     
NameError: name 'batch' is not defined
2024-03-11 04:54:52,597 - INFO - =================== New Run Started: 2024-03-11 04:54:52 ===================
2024-03-11 04:54:52,597 - INFO - Training X_Reporto Started
2024-03-11 04:54:52,598 - INFO - DEVICE: cuda
2024-03-11 04:54:52,598 - INFO - OPERATION_MODE: 1
2024-03-11 04:54:52,599 - INFO - MODEL_STAGE: 3
2024-03-11 04:54:52,599 - INFO - CONTINUE_TRAIN: False
2024-03-11 04:54:52,599 - INFO - TRAIN_RPN: False
2024-03-11 04:54:52,599 - INFO - TRAIN_ROI: False
2024-03-11 04:54:52,600 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 04:54:52,600 - INFO - RUN: 0
2024-03-11 04:54:52,600 - INFO - EPOCHS: 6
2024-03-11 04:54:52,600 - INFO - BATCH_SIZE: 1
2024-03-11 04:54:52,601 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 04:54:52,601 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 04:54:52,601 - INFO - LM_Batch_Size: 1
2024-03-11 04:54:52,601 - INFO - LEARNING_RATE: 0.0004
2024-03-11 04:54:52,602 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 04:54:52,602 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 04:54:52,602 - INFO - DEBUG: True
2024-03-11 04:54:52,602 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 04:54:52,602 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 04:54:52,603 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 04:54:52,603 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:54:52,604 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:54:52,604 - INFO - training_csv_path: datasets/train.csv
2024-03-11 04:54:52,604 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 04:54:52,604 - INFO - PERIODIC_LOGGING: True
2024-03-11 04:54:52,604 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 04:54:52,605 - INFO - RECOVER: False
2024-03-11 04:54:52,605 - INFO - Folder 'models/0' already exists.
2024-03-11 04:54:52,605 - INFO - Folder 'check_points/0' already exists.
2024-03-11 04:54:52,606 - INFO - Folder './tensor_boards/0/train_2024-03-11_04-54-52' created successfully.
2024-03-11 04:54:55,512 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 04:54:56,044 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:54:56,195 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:54:57,445 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 04:54:57,491 - INFO - Loading object_detector .....
2024-03-11 04:54:58,577 - INFO - All object_detector paramets are Frozen
2024-03-11 04:54:58,577 - INFO - Loading region_classifier .....
2024-03-11 04:54:58,586 - INFO - Loading abnormal_classifier .....
2024-03-11 04:54:59,135 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:54:59,247 - INFO - Train dataset loaded
2024-03-11 04:54:59,400 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:54:59,460 - INFO - Validation dataset loaded
2024-03-11 04:54:59,460 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 04:54:59,461 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 04:54:59,461 - INFO - Start Training
2024-03-11 04:55:52,256 - DEBUG - images.device: cuda:0
2024-03-11 04:56:00,029 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7184 selection_classifier_Loss: 1.0904 abnormal_classifier_Loss: 1.3907 LM_losses: 113.7986 total_Loss: 118.9981
2024-03-11 04:56:00,130 - DEBUG - images.device: cuda:0
2024-03-11 04:56:02,014 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 507, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 496, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 318, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch_idx,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 307, in forward
    object_detector_losses,object_detector_boxes,object_detector_detected_classes,object_detector_features = self.object_detector(images=images, targets=object_detector_targets)
                                                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\object_detector_factory.py", line 78, in forward
    object_detector_losses, object_detector_predictions =self.object_detector(images,targets)
                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\frccn_object_detector_v1.py", line 208, in forward
    proposals, proposal_losses = self.rpn(images, features, targets)
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\rpn.py", line 84, in forward
    labels, matched_gt_boxes = self.assign_targets_to_anchors(anchors, targets)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\models\detection\rpn.py", line 207, in assign_targets_to_anchors
    match_quality_matrix = self.box_similarity(gt_boxes, anchors_per_image)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 271, in box_iou
    inter, union = _box_inter_union(boxes1, boxes2)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 244, in _box_inter_union
    lt = torch.max(boxes1[:, None, :2], boxes2[:, :2])  # [N,M,2]
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!
2024-03-11 04:56:57,327 - INFO - =================== New Run Started: 2024-03-11 04:56:57 ===================
2024-03-11 04:56:57,327 - INFO - Training X_Reporto Started
2024-03-11 04:56:57,327 - INFO - DEVICE: cuda
2024-03-11 04:56:57,327 - INFO - OPERATION_MODE: 1
2024-03-11 04:56:57,328 - INFO - MODEL_STAGE: 3
2024-03-11 04:56:57,328 - INFO - CONTINUE_TRAIN: False
2024-03-11 04:56:57,328 - INFO - TRAIN_RPN: False
2024-03-11 04:56:57,328 - INFO - TRAIN_ROI: False
2024-03-11 04:56:57,329 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 04:56:57,329 - INFO - RUN: 0
2024-03-11 04:56:57,329 - INFO - EPOCHS: 6
2024-03-11 04:56:57,329 - INFO - BATCH_SIZE: 1
2024-03-11 04:56:57,330 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 04:56:57,330 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 04:56:57,330 - INFO - LM_Batch_Size: 1
2024-03-11 04:56:57,330 - INFO - LEARNING_RATE: 0.0004
2024-03-11 04:56:57,330 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 04:56:57,331 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 04:56:57,331 - INFO - DEBUG: True
2024-03-11 04:56:57,331 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 04:56:57,331 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 04:56:57,331 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 04:56:57,332 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:56:57,332 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:56:57,332 - INFO - training_csv_path: datasets/train.csv
2024-03-11 04:56:57,332 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 04:56:57,333 - INFO - PERIODIC_LOGGING: True
2024-03-11 04:56:57,333 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 04:56:57,333 - INFO - RECOVER: False
2024-03-11 04:56:57,333 - INFO - Folder 'models/0' already exists.
2024-03-11 04:56:57,333 - INFO - Folder 'check_points/0' already exists.
2024-03-11 04:56:57,334 - INFO - Folder './tensor_boards/0/train_2024-03-11_04-56-57' created successfully.
2024-03-11 04:57:00,570 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 04:57:01,212 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:57:01,371 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:57:02,654 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 04:57:02,708 - INFO - Loading object_detector .....
2024-03-11 04:57:03,747 - INFO - All object_detector paramets are Frozen
2024-03-11 04:57:03,748 - INFO - Loading region_classifier .....
2024-03-11 04:57:03,755 - INFO - Loading abnormal_classifier .....
2024-03-11 04:57:04,340 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:57:04,440 - INFO - Train dataset loaded
2024-03-11 04:57:04,596 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:57:04,676 - INFO - Validation dataset loaded
2024-03-11 04:57:04,676 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 04:57:04,677 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 04:57:04,677 - INFO - Start Training
2024-03-11 04:57:55,262 - DEBUG - images.device: cuda:0
2024-03-11 04:57:55,264 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:58:02,477 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7789 selection_classifier_Loss: 1.0873 abnormal_classifier_Loss: 1.3925 LM_losses: 157.0787 total_Loss: 162.3373
2024-03-11 04:58:02,617 - DEBUG - images.device: cuda:0
2024-03-11 04:58:02,618 - DEBUG - object_detector_targets.device: cpu
2024-03-11 04:58:04,765 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 509, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 498, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 320, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch_idx,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 307, in forward
    object_detector_losses,object_detector_boxes,object_detector_detected_classes,object_detector_features = self.object_detector(images=images, targets=object_detector_targets)
                                                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\object_detector_factory.py", line 78, in forward
    object_detector_losses, object_detector_predictions =self.object_detector(images,targets)
                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\frccn_object_detector_v1.py", line 208, in forward
    proposals, proposal_losses = self.rpn(images, features, targets)
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\rpn.py", line 84, in forward
    labels, matched_gt_boxes = self.assign_targets_to_anchors(anchors, targets)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\models\detection\rpn.py", line 207, in assign_targets_to_anchors
    match_quality_matrix = self.box_similarity(gt_boxes, anchors_per_image)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 271, in box_iou
    inter, union = _box_inter_union(boxes1, boxes2)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\boxes.py", line 244, in _box_inter_union
    lt = torch.max(boxes1[:, None, :2], boxes2[:, :2])  # [N,M,2]
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!
2024-03-11 04:58:38,687 - INFO - =================== New Run Started: 2024-03-11 04:58:38 ===================
2024-03-11 04:58:38,687 - INFO - Training X_Reporto Started
2024-03-11 04:58:38,687 - INFO - DEVICE: cuda
2024-03-11 04:58:38,688 - INFO - OPERATION_MODE: 1
2024-03-11 04:58:38,688 - INFO - MODEL_STAGE: 3
2024-03-11 04:58:38,688 - INFO - CONTINUE_TRAIN: False
2024-03-11 04:58:38,688 - INFO - TRAIN_RPN: False
2024-03-11 04:58:38,689 - INFO - TRAIN_ROI: False
2024-03-11 04:58:38,689 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 04:58:38,689 - INFO - RUN: 0
2024-03-11 04:58:38,689 - INFO - EPOCHS: 6
2024-03-11 04:58:38,689 - INFO - BATCH_SIZE: 1
2024-03-11 04:58:38,690 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 04:58:38,690 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 04:58:38,690 - INFO - LM_Batch_Size: 1
2024-03-11 04:58:38,690 - INFO - LEARNING_RATE: 0.0004
2024-03-11 04:58:38,691 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 04:58:38,691 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 04:58:38,691 - INFO - DEBUG: True
2024-03-11 04:58:38,691 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 04:58:38,691 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 04:58:38,692 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 04:58:38,692 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:58:38,692 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 04:58:38,692 - INFO - training_csv_path: datasets/train.csv
2024-03-11 04:58:38,693 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 04:58:38,693 - INFO - PERIODIC_LOGGING: True
2024-03-11 04:58:38,693 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 04:58:38,693 - INFO - RECOVER: False
2024-03-11 04:58:38,694 - INFO - Folder 'models/0' already exists.
2024-03-11 04:58:38,694 - INFO - Folder 'check_points/0' already exists.
2024-03-11 04:58:38,694 - INFO - Folder './tensor_boards/0/train_2024-03-11_04-58-38' created successfully.
2024-03-11 04:58:41,970 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 04:58:42,645 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:58:42,898 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 04:58:44,195 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 04:58:44,254 - INFO - Loading object_detector .....
2024-03-11 04:58:45,423 - INFO - All object_detector paramets are Frozen
2024-03-11 04:58:45,423 - INFO - Loading region_classifier .....
2024-03-11 04:58:45,440 - INFO - Loading abnormal_classifier .....
2024-03-11 04:58:46,059 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:58:46,133 - INFO - Train dataset loaded
2024-03-11 04:58:46,286 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 04:58:46,358 - INFO - Validation dataset loaded
2024-03-11 04:58:46,359 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 04:58:46,360 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 04:58:46,360 - INFO - Start Training
2024-03-11 04:59:35,868 - DEBUG - images.device: cuda:0
2024-03-11 04:59:35,868 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:43,106 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7617 selection_classifier_Loss: 1.0957 abnormal_classifier_Loss: 1.3889 LM_losses: 113.3129 total_Loss: 118.5593
2024-03-11 04:59:43,217 - DEBUG - images.device: cuda:0
2024-03-11 04:59:43,218 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:43,550 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7186 selection_classifier_Loss: 1.1132 abnormal_classifier_Loss: 1.3952 LM_losses: 229.4142 total_Loss: 234.6411
2024-03-11 04:59:43,655 - DEBUG - images.device: cuda:0
2024-03-11 04:59:43,656 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:43,976 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6901 selection_classifier_Loss: 1.0911 abnormal_classifier_Loss: 1.3992 LM_losses: 366.1239 total_Loss: 371.3043
2024-03-11 04:59:44,080 - DEBUG - images.device: cuda:0
2024-03-11 04:59:44,080 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:44,388 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7358 selection_classifier_Loss: 1.1039 abnormal_classifier_Loss: 1.3878 LM_losses: 498.2772 total_Loss: 503.5047
2024-03-11 04:59:44,481 - DEBUG - images.device: cuda:0
2024-03-11 04:59:44,481 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:44,794 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8114 selection_classifier_Loss: 1.0996 abnormal_classifier_Loss: 1.3958 LM_losses: 606.0189 total_Loss: 611.3257
2024-03-11 04:59:44,890 - DEBUG - images.device: cuda:0
2024-03-11 04:59:44,890 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:45,204 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8002 selection_classifier_Loss: 1.1094 abnormal_classifier_Loss: 1.3976 LM_losses: 749.5115 total_Loss: 754.8186
2024-03-11 04:59:45,306 - DEBUG - images.device: cuda:0
2024-03-11 04:59:45,306 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:45,640 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7131 selection_classifier_Loss: 1.0854 abnormal_classifier_Loss: 1.3914 LM_losses: 882.4881 total_Loss: 887.6780
2024-03-11 04:59:45,734 - DEBUG - images.device: cuda:0
2024-03-11 04:59:45,735 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:46,064 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7589 selection_classifier_Loss: 1.1003 abnormal_classifier_Loss: 1.3926 LM_losses: 1009.5464 total_Loss: 1014.7982
2024-03-11 04:59:46,157 - DEBUG - images.device: cuda:0
2024-03-11 04:59:46,157 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:46,556 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7624 selection_classifier_Loss: 1.0872 abnormal_classifier_Loss: 1.3916 LM_losses: 1117.0764 total_Loss: 1122.3176
2024-03-11 04:59:46,669 - DEBUG - images.device: cuda:0
2024-03-11 04:59:46,670 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:47,376 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 04:59:47,376 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0004000000
2024-03-11 04:59:47,803 - DEBUG - images.device: cuda:0
2024-03-11 04:59:47,803 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:48,248 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5142 selection_classifier_Loss: 1.7353 abnormal_classifier_Loss: 4.8912 LM_losses: 99.1237 total_Loss: 108.2644
2024-03-11 04:59:48,348 - DEBUG - images.device: cuda:0
2024-03-11 04:59:48,348 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:48,658 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5167 selection_classifier_Loss: 1.7274 abnormal_classifier_Loss: 4.8956 LM_losses: 185.7460 total_Loss: 194.8857
2024-03-11 04:59:48,754 - DEBUG - images.device: cuda:0
2024-03-11 04:59:48,755 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:49,075 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4918 selection_classifier_Loss: 1.7509 abnormal_classifier_Loss: 4.9027 LM_losses: 271.5005 total_Loss: 280.6459
2024-03-11 04:59:49,180 - DEBUG - images.device: cuda:0
2024-03-11 04:59:49,181 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:49,513 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5188 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 367.1552 total_Loss: 376.3342
2024-03-11 04:59:49,608 - DEBUG - images.device: cuda:0
2024-03-11 04:59:49,609 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:49,978 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4347 selection_classifier_Loss: 1.7210 abnormal_classifier_Loss: 4.8842 LM_losses: 447.5098 total_Loss: 456.5496
2024-03-11 04:59:50,072 - DEBUG - images.device: cuda:0
2024-03-11 04:59:50,073 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:50,429 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4944 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 554.3120 total_Loss: 563.4667
2024-03-11 04:59:50,521 - DEBUG - images.device: cuda:0
2024-03-11 04:59:50,521 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:51,284 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5351 selection_classifier_Loss: 1.7353 abnormal_classifier_Loss: 4.8912 LM_losses: 637.3373 total_Loss: 646.4988
2024-03-11 04:59:51,380 - DEBUG - images.device: cuda:0
2024-03-11 04:59:51,380 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:51,741 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4956 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: 759.9404 total_Loss: 769.0861
2024-03-11 04:59:51,838 - DEBUG - images.device: cuda:0
2024-03-11 04:59:51,839 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 04:59:53,725 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 509, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 498, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 320, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch_idx,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 347, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.88 GiB is allocated by PyTorch, and 314.29 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 05:00:27,241 - INFO - =================== New Run Started: 2024-03-11 05:00:27 ===================
2024-03-11 05:00:27,242 - INFO - Training X_Reporto Started
2024-03-11 05:00:27,242 - INFO - DEVICE: cuda
2024-03-11 05:00:27,242 - INFO - OPERATION_MODE: 1
2024-03-11 05:00:27,243 - INFO - MODEL_STAGE: 3
2024-03-11 05:00:27,243 - INFO - CONTINUE_TRAIN: False
2024-03-11 05:00:27,243 - INFO - TRAIN_RPN: False
2024-03-11 05:00:27,243 - INFO - TRAIN_ROI: False
2024-03-11 05:00:27,243 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 05:00:27,244 - INFO - RUN: 0
2024-03-11 05:00:27,244 - INFO - EPOCHS: 6
2024-03-11 05:00:27,244 - INFO - BATCH_SIZE: 1
2024-03-11 05:00:27,244 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 05:00:27,244 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 05:00:27,245 - INFO - LM_Batch_Size: 4
2024-03-11 05:00:27,245 - INFO - LEARNING_RATE: 0.0004
2024-03-11 05:00:27,245 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 05:00:27,245 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 05:00:27,245 - INFO - DEBUG: True
2024-03-11 05:00:27,246 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 05:00:27,246 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 05:00:27,246 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 05:00:27,246 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 05:00:27,246 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 05:00:27,247 - INFO - training_csv_path: datasets/train.csv
2024-03-11 05:00:27,247 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 05:00:27,247 - INFO - PERIODIC_LOGGING: True
2024-03-11 05:00:27,247 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 05:00:27,248 - INFO - RECOVER: False
2024-03-11 05:00:27,248 - INFO - Folder 'models/0' already exists.
2024-03-11 05:00:27,248 - INFO - Folder 'check_points/0' already exists.
2024-03-11 05:00:27,249 - INFO - Folder './tensor_boards/0/train_2024-03-11_05-00-27' created successfully.
2024-03-11 05:00:30,716 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 05:00:31,623 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 05:00:31,780 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 05:00:33,100 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 05:00:33,152 - INFO - Loading object_detector .....
2024-03-11 05:00:34,222 - INFO - All object_detector paramets are Frozen
2024-03-11 05:00:34,223 - INFO - Loading region_classifier .....
2024-03-11 05:00:34,235 - INFO - Loading abnormal_classifier .....
2024-03-11 05:00:34,840 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 05:00:34,947 - INFO - Train dataset loaded
2024-03-11 05:00:35,100 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 05:00:35,204 - INFO - Validation dataset loaded
2024-03-11 05:00:35,204 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 05:00:35,205 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 05:00:35,205 - INFO - Start Training
2024-03-11 05:01:28,072 - DEBUG - images.device: cuda:0
2024-03-11 05:01:28,072 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 05:01:35,332 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8123 selection_classifier_Loss: 1.0816 abnormal_classifier_Loss: 1.3938 LM_losses: 104.8244 total_Loss: 110.1121
2024-03-11 05:01:35,455 - DEBUG - images.device: cuda:0
2024-03-11 05:01:35,455 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 05:01:39,710 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7460 selection_classifier_Loss: 1.1129 abnormal_classifier_Loss: 1.4511 LM_losses: 212.1662 total_Loss: 217.4762
2024-03-11 05:01:39,809 - DEBUG - images.device: cuda:0
2024-03-11 05:01:39,810 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 05:01:46,930 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 05:01:46,930 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0004000000
2024-03-11 05:01:51,863 - DEBUG - images.device: cuda:0
2024-03-11 05:01:51,864 - DEBUG - object_detector_targets.device: cuda:0
2024-03-11 05:01:54,406 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 509, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 498, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 169, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 320, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch_idx,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 347, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 218, in forward
    shift_logits = logits[..., :-1, :].contiguous()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 786.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 3.73 GiB is allocated by PyTorch, and 1.13 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:00:21,501 - INFO - =================== New Run Started: 2024-03-11 09:00:21 ===================
2024-03-11 09:00:21,502 - INFO - Training X_Reporto Started
2024-03-11 09:00:21,502 - INFO - DEVICE: cuda
2024-03-11 09:00:21,502 - INFO - OPERATION_MODE: 1
2024-03-11 09:00:21,502 - INFO - MODEL_STAGE: 3
2024-03-11 09:00:21,502 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:00:21,502 - INFO - TRAIN_RPN: False
2024-03-11 09:00:21,503 - INFO - TRAIN_ROI: False
2024-03-11 09:00:21,503 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:00:21,503 - INFO - RUN: 0
2024-03-11 09:00:21,503 - INFO - EPOCHS: 6
2024-03-11 09:00:21,504 - INFO - BATCH_SIZE: 1
2024-03-11 09:00:21,504 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:00:21,504 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:00:21,504 - INFO - LM_Batch_Size: 4
2024-03-11 09:00:21,504 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:00:21,505 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:00:21,505 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:00:21,505 - INFO - DEBUG: True
2024-03-11 09:00:21,505 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:00:21,505 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:00:21,506 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:00:21,506 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:00:21,506 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:00:21,506 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:00:21,506 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:00:21,507 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:00:21,507 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:00:21,507 - INFO - RECOVER: False
2024-03-11 09:00:21,508 - INFO - Folder 'models/0' already exists.
2024-03-11 09:00:21,508 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:00:21,508 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-00-21' created successfully.
2024-03-11 09:00:24,913 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:00:25,525 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:00:25,868 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:00:27,441 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:00:27,494 - INFO - Loading object_detector .....
2024-03-11 09:00:28,616 - INFO - All object_detector paramets are Frozen
2024-03-11 09:00:28,616 - INFO - Loading region_classifier .....
2024-03-11 09:00:28,625 - INFO - Loading abnormal_classifier .....
2024-03-11 09:00:29,336 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:00:29,421 - INFO - Train dataset loaded
2024-03-11 09:00:29,576 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:00:29,637 - INFO - Validation dataset loaded
2024-03-11 09:00:29,638 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:00:29,638 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:00:29,639 - INFO - Start Training
2024-03-11 09:01:40,615 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7617 selection_classifier_Loss: 1.2018 abnormal_classifier_Loss: 1.5671 LM_losses: 124.4465 total_Loss: 129.9772
2024-03-11 09:01:42,469 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7932 selection_classifier_Loss: 1.0925 abnormal_classifier_Loss: 1.3917 LM_losses: 256.0554 total_Loss: 261.3328
2024-03-11 09:01:46,716 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 513, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 502, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 177, in train
    Total_loss.backward()
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\_tensor.py", line 522, in backward
    torch.autograd.backward(
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\autograd\__init__.py", line 266, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 786.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 3.83 GiB is allocated by PyTorch, and 1.06 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:02:36,856 - INFO - =================== New Run Started: 2024-03-11 09:02:36 ===================
2024-03-11 09:02:36,857 - INFO - Training X_Reporto Started
2024-03-11 09:02:36,857 - INFO - DEVICE: cuda
2024-03-11 09:02:36,857 - INFO - OPERATION_MODE: 1
2024-03-11 09:02:36,857 - INFO - MODEL_STAGE: 3
2024-03-11 09:02:36,858 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:02:36,858 - INFO - TRAIN_RPN: False
2024-03-11 09:02:36,858 - INFO - TRAIN_ROI: False
2024-03-11 09:02:36,859 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:02:36,859 - INFO - RUN: 0
2024-03-11 09:02:36,859 - INFO - EPOCHS: 6
2024-03-11 09:02:36,859 - INFO - BATCH_SIZE: 1
2024-03-11 09:02:36,859 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:02:36,860 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:02:36,860 - INFO - LM_Batch_Size: 2
2024-03-11 09:02:36,860 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:02:36,861 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:02:36,861 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:02:36,861 - INFO - DEBUG: True
2024-03-11 09:02:36,861 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:02:36,862 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:02:36,862 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:02:36,862 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:02:36,863 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:02:36,863 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:02:36,863 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:02:36,863 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:02:36,864 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:02:36,864 - INFO - RECOVER: False
2024-03-11 09:02:36,865 - INFO - Folder 'models/0' already exists.
2024-03-11 09:02:36,865 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:02:36,866 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-02-36' created successfully.
2024-03-11 09:02:40,351 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:02:41,216 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:02:41,371 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:02:42,681 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:02:42,733 - INFO - Loading object_detector .....
2024-03-11 09:02:43,898 - INFO - All object_detector paramets are Frozen
2024-03-11 09:02:43,898 - INFO - Loading region_classifier .....
2024-03-11 09:02:43,909 - INFO - Loading abnormal_classifier .....
2024-03-11 09:02:44,403 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:02:44,484 - INFO - Train dataset loaded
2024-03-11 09:02:44,839 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:02:44,901 - INFO - Validation dataset loaded
2024-03-11 09:02:44,902 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:02:44,902 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:02:44,903 - INFO - Start Training
2024-03-11 09:03:47,903 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7422 selection_classifier_Loss: 1.0945 abnormal_classifier_Loss: 1.4009 LM_losses: 106.7692 total_Loss: 112.0069
2024-03-11 09:03:48,679 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7008 selection_classifier_Loss: 1.0884 abnormal_classifier_Loss: 1.3911 LM_losses: 227.0699 total_Loss: 232.2503
2024-03-11 09:03:49,215 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8049 selection_classifier_Loss: 1.1147 abnormal_classifier_Loss: 1.4522 LM_losses: 335.2850 total_Loss: 340.6568
2024-03-11 09:03:49,734 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6849 selection_classifier_Loss: 1.0854 abnormal_classifier_Loss: 1.3914 LM_losses: 456.1704 total_Loss: 461.3321
2024-03-11 09:03:53,481 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:03:53,481 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:03:54,011 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4828 selection_classifier_Loss: 1.7458 abnormal_classifier_Loss: 4.9179 LM_losses: 40.8734 total_Loss: 50.0201
2024-03-11 09:03:54,539 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4657 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 81.6635 total_Loss: 90.7894
2024-03-11 09:03:55,494 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4934 selection_classifier_Loss: 1.7326 abnormal_classifier_Loss: 4.8467 LM_losses: 121.4391 total_Loss: 130.5118
2024-03-11 09:03:57,495 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 352, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 218, in forward
    shift_logits = logits[..., :-1, :].contiguous()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 394.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.65 GiB is allocated by PyTorch, and 637.36 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:04:17,909 - INFO - =================== New Run Started: 2024-03-11 09:04:17 ===================
2024-03-11 09:04:17,909 - INFO - Training X_Reporto Started
2024-03-11 09:04:17,909 - INFO - DEVICE: cuda
2024-03-11 09:04:17,910 - INFO - OPERATION_MODE: 1
2024-03-11 09:04:17,910 - INFO - MODEL_STAGE: 3
2024-03-11 09:04:17,910 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:04:17,910 - INFO - TRAIN_RPN: False
2024-03-11 09:04:17,910 - INFO - TRAIN_ROI: False
2024-03-11 09:04:17,911 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:04:17,911 - INFO - RUN: 0
2024-03-11 09:04:17,911 - INFO - EPOCHS: 6
2024-03-11 09:04:17,911 - INFO - BATCH_SIZE: 1
2024-03-11 09:04:17,911 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:04:17,912 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:04:17,912 - INFO - LM_Batch_Size: 1
2024-03-11 09:04:17,912 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:04:17,912 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:04:17,913 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:04:17,913 - INFO - DEBUG: True
2024-03-11 09:04:17,913 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:04:17,914 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:04:17,914 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:04:17,914 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:04:17,914 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:04:17,915 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:04:17,915 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:04:17,915 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:04:17,916 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:04:17,916 - INFO - RECOVER: False
2024-03-11 09:04:17,916 - INFO - Folder 'models/0' already exists.
2024-03-11 09:04:17,916 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:04:17,917 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-04-17' created successfully.
2024-03-11 09:04:21,848 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:04:22,750 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:04:22,910 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:04:24,321 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:04:24,375 - INFO - Loading object_detector .....
2024-03-11 09:04:25,561 - INFO - All object_detector paramets are Frozen
2024-03-11 09:04:25,562 - INFO - Loading region_classifier .....
2024-03-11 09:04:25,569 - INFO - Loading abnormal_classifier .....
2024-03-11 09:04:26,117 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:04:26,199 - INFO - Train dataset loaded
2024-03-11 09:04:26,712 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:04:26,789 - INFO - Validation dataset loaded
2024-03-11 09:04:26,790 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:04:26,790 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:04:26,790 - INFO - Start Training
2024-03-11 09:05:34,664 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7714 selection_classifier_Loss: 1.0875 abnormal_classifier_Loss: 1.4009 LM_losses: 110.7523 total_Loss: 116.0120
2024-03-11 09:05:35,380 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8290 selection_classifier_Loss: 1.1028 abnormal_classifier_Loss: 1.3892 LM_losses: 256.1099 total_Loss: 261.4308
2024-03-11 09:05:35,802 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7549 selection_classifier_Loss: 1.0939 abnormal_classifier_Loss: 1.3883 LM_losses: 388.8680 total_Loss: 394.1053
2024-03-11 09:05:36,252 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8135 selection_classifier_Loss: 1.0982 abnormal_classifier_Loss: 1.3901 LM_losses: 515.5622 total_Loss: 520.8640
2024-03-11 09:05:36,688 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6874 selection_classifier_Loss: 1.1048 abnormal_classifier_Loss: 1.3987 LM_losses: 636.9375 total_Loss: 642.1285
2024-03-11 09:05:37,106 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7948 selection_classifier_Loss: 1.0873 abnormal_classifier_Loss: 1.3925 LM_losses: 760.5263 total_Loss: 765.8009
2024-03-11 09:05:37,542 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6979 selection_classifier_Loss: 1.1198 abnormal_classifier_Loss: 1.4468 LM_losses: 854.7319 total_Loss: 859.9964
2024-03-11 09:05:37,963 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6785 selection_classifier_Loss: 1.1098 abnormal_classifier_Loss: 1.3946 LM_losses: 994.8312 total_Loss: 1000.0140
2024-03-11 09:05:38,377 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7088 selection_classifier_Loss: 1.1098 abnormal_classifier_Loss: 1.3946 LM_losses: 1122.8247 total_Loss: 1128.0378
2024-03-11 09:05:43,026 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:05:43,026 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:05:43,584 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4970 selection_classifier_Loss: 1.6336 abnormal_classifier_Loss: 4.9716 LM_losses: 39.0216 total_Loss: 48.1237
2024-03-11 09:05:44,010 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5089 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 80.5212 total_Loss: 89.6903
2024-03-11 09:05:44,418 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4779 selection_classifier_Loss: 1.7458 abnormal_classifier_Loss: 4.9179 LM_losses: 122.5636 total_Loss: 131.7053
2024-03-11 09:05:44,799 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5301 selection_classifier_Loss: 1.7264 abnormal_classifier_Loss: 4.9262 LM_losses: 166.0473 total_Loss: 175.2301
2024-03-11 09:05:45,237 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5244 selection_classifier_Loss: 1.7264 abnormal_classifier_Loss: 4.9262 LM_losses: 209.9207 total_Loss: 219.0977
2024-03-11 09:05:45,713 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4827 selection_classifier_Loss: 1.7406 abnormal_classifier_Loss: 4.8422 LM_losses: 250.1352 total_Loss: 259.2007
2024-03-11 09:05:48,607 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4663 selection_classifier_Loss: 1.7509 abnormal_classifier_Loss: 4.9027 LM_losses: 287.9747 total_Loss: 297.0945
2024-03-11 09:05:49,691 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4779 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 327.8129 total_Loss: 336.9511
2024-03-11 09:05:52,007 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 352, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.89 GiB is allocated by PyTorch, and 327.93 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:07:39,288 - INFO - =================== New Run Started: 2024-03-11 09:07:39 ===================
2024-03-11 09:07:39,288 - INFO - Training X_Reporto Started
2024-03-11 09:07:39,289 - INFO - DEVICE: cuda
2024-03-11 09:07:39,289 - INFO - OPERATION_MODE: 1
2024-03-11 09:07:39,289 - INFO - MODEL_STAGE: 3
2024-03-11 09:07:39,289 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:07:39,290 - INFO - TRAIN_RPN: False
2024-03-11 09:07:39,290 - INFO - TRAIN_ROI: False
2024-03-11 09:07:39,290 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:07:39,290 - INFO - RUN: 0
2024-03-11 09:07:39,290 - INFO - EPOCHS: 6
2024-03-11 09:07:39,291 - INFO - BATCH_SIZE: 1
2024-03-11 09:07:39,291 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:07:39,291 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:07:39,291 - INFO - LM_Batch_Size: 1
2024-03-11 09:07:39,291 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:07:39,292 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:07:39,292 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:07:39,292 - INFO - DEBUG: True
2024-03-11 09:07:39,292 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:07:39,293 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:07:39,293 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:07:39,293 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:07:39,294 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:07:39,294 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:07:39,294 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:07:39,295 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:07:39,295 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:07:39,295 - INFO - RECOVER: False
2024-03-11 09:07:39,295 - INFO - Folder 'models/0' already exists.
2024-03-11 09:07:39,295 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:07:39,296 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-07-39' created successfully.
2024-03-11 09:07:42,884 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:07:43,705 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:07:43,860 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:07:45,397 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:07:45,452 - INFO - Loading object_detector .....
2024-03-11 09:07:46,675 - INFO - All object_detector paramets are Frozen
2024-03-11 09:07:46,676 - INFO - Loading region_classifier .....
2024-03-11 09:07:46,685 - INFO - Loading abnormal_classifier .....
2024-03-11 09:07:47,434 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:07:47,533 - INFO - Train dataset loaded
2024-03-11 09:07:47,683 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:07:47,773 - INFO - Validation dataset loaded
2024-03-11 09:07:47,774 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:07:47,774 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:07:47,774 - INFO - Start Training
2024-03-11 09:08:53,638 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7525 selection_classifier_Loss: 1.0917 abnormal_classifier_Loss: 1.3869 LM_losses: 104.5125 total_Loss: 109.7435
2024-03-11 09:08:54,203 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7757 selection_classifier_Loss: 1.1030 abnormal_classifier_Loss: 1.3976 LM_losses: 216.4751 total_Loss: 221.7514
2024-03-11 09:08:54,688 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7493 selection_classifier_Loss: 1.0869 abnormal_classifier_Loss: 1.3966 LM_losses: 331.3417 total_Loss: 336.5745
2024-03-11 09:08:55,206 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8058 selection_classifier_Loss: 1.0925 abnormal_classifier_Loss: 1.3917 LM_losses: 465.6689 total_Loss: 470.9589
2024-03-11 09:08:55,666 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7722 selection_classifier_Loss: 1.1030 abnormal_classifier_Loss: 1.3976 LM_losses: 568.8606 total_Loss: 574.1334
2024-03-11 09:08:56,144 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8227 selection_classifier_Loss: 1.1169 abnormal_classifier_Loss: 1.4573 LM_losses: 667.7307 total_Loss: 673.1276
2024-03-11 09:08:56,613 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7165 selection_classifier_Loss: 1.0956 abnormal_classifier_Loss: 1.3881 LM_losses: 834.2773 total_Loss: 839.4775
2024-03-11 09:08:57,085 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7368 selection_classifier_Loss: 1.1048 abnormal_classifier_Loss: 1.3987 LM_losses: 971.3022 total_Loss: 976.5425
2024-03-11 09:08:57,573 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7324 selection_classifier_Loss: 1.1170 abnormal_classifier_Loss: 1.3937 LM_losses: 1075.3947 total_Loss: 1080.6377
2024-03-11 09:08:58,064 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7725 selection_classifier_Loss: 1.0957 abnormal_classifier_Loss: 1.3889 LM_losses: 1182.0962 total_Loss: 1187.3533
2024-03-11 09:09:02,532 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:09:02,532 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:09:03,427 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4913 selection_classifier_Loss: 1.7377 abnormal_classifier_Loss: 4.8822 LM_losses: 41.0302 total_Loss: 50.1414
2024-03-11 09:09:03,868 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5211 selection_classifier_Loss: 1.7353 abnormal_classifier_Loss: 4.8912 LM_losses: 79.8210 total_Loss: 88.9686
2024-03-11 09:09:04,335 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4630 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: 119.1332 total_Loss: 128.2463
2024-03-11 09:09:04,774 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5064 selection_classifier_Loss: 1.7264 abnormal_classifier_Loss: 4.9262 LM_losses: 157.9693 total_Loss: 167.1283
2024-03-11 09:09:05,209 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4957 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: 199.4603 total_Loss: 208.6163
2024-03-11 09:09:05,654 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5528 selection_classifier_Loss: 1.7458 abnormal_classifier_Loss: 4.9179 LM_losses: 241.2613 total_Loss: 250.4779
2024-03-11 09:09:06,151 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4719 selection_classifier_Loss: 1.7274 abnormal_classifier_Loss: 4.8956 LM_losses: 280.7517 total_Loss: 289.8466
2024-03-11 09:09:06,632 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5379 selection_classifier_Loss: 1.7274 abnormal_classifier_Loss: 4.8956 LM_losses: 321.0061 total_Loss: 330.1670
2024-03-11 09:09:08,876 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 353, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.88 GiB is allocated by PyTorch, and 370.28 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:10:28,960 - INFO - =================== New Run Started: 2024-03-11 09:10:28 ===================
2024-03-11 09:10:28,960 - INFO - Training X_Reporto Started
2024-03-11 09:10:28,960 - INFO - DEVICE: cuda
2024-03-11 09:10:28,961 - INFO - OPERATION_MODE: 1
2024-03-11 09:10:28,961 - INFO - MODEL_STAGE: 3
2024-03-11 09:10:28,961 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:10:28,961 - INFO - TRAIN_RPN: False
2024-03-11 09:10:28,962 - INFO - TRAIN_ROI: False
2024-03-11 09:10:28,962 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:10:28,962 - INFO - RUN: 0
2024-03-11 09:10:28,962 - INFO - EPOCHS: 6
2024-03-11 09:10:28,963 - INFO - BATCH_SIZE: 1
2024-03-11 09:10:28,963 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:10:28,963 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:10:28,963 - INFO - LM_Batch_Size: 1
2024-03-11 09:10:28,964 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:10:28,964 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:10:28,964 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:10:28,965 - INFO - DEBUG: True
2024-03-11 09:10:28,965 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:10:28,965 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:10:28,965 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:10:28,966 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:10:28,966 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:10:28,966 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:10:28,966 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:10:28,967 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:10:28,967 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:10:28,967 - INFO - RECOVER: False
2024-03-11 09:10:28,968 - INFO - Folder 'models/0' already exists.
2024-03-11 09:10:28,968 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:10:28,968 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-10-28' created successfully.
2024-03-11 09:10:32,277 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:10:32,833 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:10:32,985 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:10:34,298 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:10:34,413 - INFO - Loading object_detector .....
2024-03-11 09:10:35,326 - INFO - All object_detector paramets are Frozen
2024-03-11 09:10:35,327 - INFO - Loading region_classifier .....
2024-03-11 09:10:35,335 - INFO - Loading abnormal_classifier .....
2024-03-11 09:10:35,755 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:10:35,833 - INFO - Train dataset loaded
2024-03-11 09:10:35,985 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:10:36,099 - INFO - Validation dataset loaded
2024-03-11 09:10:36,100 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:10:36,100 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:10:36,101 - INFO - Start Training
2024-03-11 09:11:41,039 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7529 selection_classifier_Loss: 1.1144 abnormal_classifier_Loss: 1.3938 LM_losses: 105.2264 total_Loss: 110.4874
2024-03-11 09:11:41,979 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7254 selection_classifier_Loss: 1.1080 abnormal_classifier_Loss: 1.3951 LM_losses: 221.9801 total_Loss: 227.2086
2024-03-11 09:11:42,950 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7776 selection_classifier_Loss: 1.0968 abnormal_classifier_Loss: 1.3958 LM_losses: 328.9570 total_Loss: 334.2273
2024-03-11 09:11:43,924 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7307 selection_classifier_Loss: 1.1031 abnormal_classifier_Loss: 1.4455 LM_losses: 418.0746 total_Loss: 423.3539
2024-03-11 09:11:44,786 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7449 selection_classifier_Loss: 1.0875 abnormal_classifier_Loss: 1.4009 LM_losses: 536.9542 total_Loss: 542.1875
2024-03-11 09:11:45,651 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7983 selection_classifier_Loss: 1.1173 abnormal_classifier_Loss: 1.4460 LM_losses: 694.8263 total_Loss: 700.1880
2024-03-11 09:11:46,508 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7956 selection_classifier_Loss: 1.1010 abnormal_classifier_Loss: 1.3988 LM_losses: 837.3700 total_Loss: 842.6654
2024-03-11 09:11:47,366 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7865 selection_classifier_Loss: 1.1019 abnormal_classifier_Loss: 1.3886 LM_losses: 1022.5685 total_Loss: 1027.8455
2024-03-11 09:11:48,227 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7372 selection_classifier_Loss: 1.1044 abnormal_classifier_Loss: 1.3928 LM_losses: 1171.4061 total_Loss: 1176.6405
2024-03-11 09:11:49,083 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7587 selection_classifier_Loss: 1.0989 abnormal_classifier_Loss: 1.3916 LM_losses: 1293.6399 total_Loss: 1298.8892
2024-03-11 09:12:04,034 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:12:04,034 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:12:04,842 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5032 selection_classifier_Loss: 1.7353 abnormal_classifier_Loss: 4.8912 LM_losses: nan total_Loss: nan
2024-03-11 09:12:05,687 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5112 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: nan total_Loss: nan
2024-03-11 09:12:06,542 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5115 selection_classifier_Loss: 1.7315 abnormal_classifier_Loss: 4.9110 LM_losses: nan total_Loss: nan
2024-03-11 09:12:07,390 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5226 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: nan total_Loss: nan
2024-03-11 09:12:08,237 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5311 selection_classifier_Loss: 1.7096 abnormal_classifier_Loss: 4.8698 LM_losses: nan total_Loss: nan
2024-03-11 09:12:09,084 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5162 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: nan total_Loss: nan
2024-03-11 09:12:09,935 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5238 selection_classifier_Loss: 1.6285 abnormal_classifier_Loss: 4.9868 LM_losses: nan total_Loss: nan
2024-03-11 09:12:10,810 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4826 selection_classifier_Loss: 1.7017 abnormal_classifier_Loss: 4.8743 LM_losses: nan total_Loss: nan
2024-03-11 09:12:11,732 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5164 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: nan total_Loss: nan
2024-03-11 09:12:12,687 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5398 selection_classifier_Loss: 1.7315 abnormal_classifier_Loss: 4.9110 LM_losses: nan total_Loss: nan
2024-03-11 09:12:13,643 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4997 selection_classifier_Loss: 1.7264 abnormal_classifier_Loss: 4.9262 LM_losses: nan total_Loss: nan
2024-03-11 09:12:14,601 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5324 selection_classifier_Loss: 1.7264 abnormal_classifier_Loss: 4.9262 LM_losses: nan total_Loss: nan
2024-03-11 09:12:34,542 - DEBUG - [Accumlative Learning after 2 steps ] Update Weights at  epoch: 1, Batch 2/200 
2024-03-11 09:12:34,542 - INFO - Epoch 1/6, Batch 2/200, Learning Rate: 0.0010000000
2024-03-11 09:12:35,517 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0726 selection_classifier_Loss: 2.0591 abnormal_classifier_Loss: 5.0378 LM_losses: nan total_Loss: nan
2024-03-11 09:12:36,395 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.1175 selection_classifier_Loss: 2.0672 abnormal_classifier_Loss: 5.0385 LM_losses: nan total_Loss: nan
2024-03-11 09:12:37,352 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0740 selection_classifier_Loss: 2.0704 abnormal_classifier_Loss: 5.0792 LM_losses: nan total_Loss: nan
2024-03-11 09:12:38,237 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0494 selection_classifier_Loss: 2.0750 abnormal_classifier_Loss: 5.0723 LM_losses: nan total_Loss: nan
2024-03-11 09:12:39,109 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0751 selection_classifier_Loss: 2.0875 abnormal_classifier_Loss: 5.0796 LM_losses: nan total_Loss: nan
2024-03-11 09:12:39,991 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0718 selection_classifier_Loss: 2.0750 abnormal_classifier_Loss: 5.0723 LM_losses: nan total_Loss: nan
2024-03-11 09:12:40,937 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0395 selection_classifier_Loss: 2.0894 abnormal_classifier_Loss: 5.0581 LM_losses: nan total_Loss: nan
2024-03-11 09:12:41,800 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0207 selection_classifier_Loss: 1.9880 abnormal_classifier_Loss: 4.8902 LM_losses: nan total_Loss: nan
2024-03-11 09:12:42,689 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0833 selection_classifier_Loss: 1.9559 abnormal_classifier_Loss: 4.8895 LM_losses: nan total_Loss: nan
2024-03-11 09:12:43,576 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0604 selection_classifier_Loss: 2.0847 abnormal_classifier_Loss: 5.0226 LM_losses: nan total_Loss: nan
2024-03-11 09:12:44,484 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0804 selection_classifier_Loss: 2.0787 abnormal_classifier_Loss: 5.0263 LM_losses: nan total_Loss: nan
2024-03-11 09:12:45,428 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.1077 selection_classifier_Loss: 2.0982 abnormal_classifier_Loss: 5.1716 LM_losses: nan total_Loss: nan
2024-03-11 09:12:46,357 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.1087 selection_classifier_Loss: 2.0521 abnormal_classifier_Loss: 5.0621 LM_losses: nan total_Loss: nan
2024-03-11 09:12:47,557 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0369 selection_classifier_Loss: 2.0501 abnormal_classifier_Loss: 5.0381 LM_losses: nan total_Loss: nan
2024-03-11 09:12:50,111 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 353, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 230, in forward
    loss = loss_fct(shift_logits.view(-1, shift_logits.size(-1)), shift_labels.view(-1))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\loss.py", line 1179, in forward
    return F.cross_entropy(input, target, weight=self.weight,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\functional.py", line 3059, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 198.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 4.99 GiB is allocated by PyTorch, and 222.33 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2024-03-11 09:13:15,678 - INFO - =================== New Run Started: 2024-03-11 09:13:15 ===================
2024-03-11 09:13:15,679 - INFO - Training X_Reporto Started
2024-03-11 09:13:15,679 - INFO - DEVICE: cuda
2024-03-11 09:13:15,679 - INFO - OPERATION_MODE: 1
2024-03-11 09:13:15,679 - INFO - MODEL_STAGE: 3
2024-03-11 09:13:15,680 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:13:15,680 - INFO - TRAIN_RPN: False
2024-03-11 09:13:15,680 - INFO - TRAIN_ROI: False
2024-03-11 09:13:15,680 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:13:15,681 - INFO - RUN: 0
2024-03-11 09:13:15,681 - INFO - EPOCHS: 6
2024-03-11 09:13:15,681 - INFO - BATCH_SIZE: 1
2024-03-11 09:13:15,682 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:13:15,682 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:13:15,682 - INFO - LM_Batch_Size: 1
2024-03-11 09:13:15,682 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:13:15,682 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:13:15,683 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:13:15,683 - INFO - DEBUG: True
2024-03-11 09:13:15,683 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:13:15,683 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:13:15,683 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:13:15,684 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:13:15,684 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:13:15,684 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:13:15,684 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:13:15,684 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:13:15,685 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:13:15,685 - INFO - RECOVER: False
2024-03-11 09:13:15,685 - INFO - Folder 'models/0' already exists.
2024-03-11 09:13:15,685 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:13:15,686 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-13-15' created successfully.
2024-03-11 09:13:19,496 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:13:20,090 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:13:20,243 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:13:21,662 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:13:21,763 - INFO - Loading object_detector .....
2024-03-11 09:13:22,811 - INFO - All object_detector paramets are Frozen
2024-03-11 09:13:22,812 - INFO - Loading region_classifier .....
2024-03-11 09:13:22,852 - INFO - Loading abnormal_classifier .....
2024-03-11 09:13:23,587 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:13:23,686 - INFO - Train dataset loaded
2024-03-11 09:13:23,838 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:13:23,944 - INFO - Validation dataset loaded
2024-03-11 09:13:23,945 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:13:23,946 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:13:23,946 - INFO - Start Training
2024-03-11 09:14:30,763 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 353, in forward
    LM_output=self.language_model(input_ids=valid_input_ids[index:index+LM_Batch_Size,:],image_hidden_states=valid_object_detector_features[index:index+LM_Batch_Size,:],attention_mask=valid_attention_mask[index:index+LM_Batch_Size,:],labels=valid_labels[index:index+LM_Batch_Size,:])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\gpt2_model.py", line 158, in forward
    image_hidden_states = self.image_to_text(image_hidden_states)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\language_model\GPT2\feed_forward.py", line 44, in forward
    x = F.relu(self.fc1(x))
               ^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\linear.py", line 116, in forward
    return F.linear(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: mat1 and mat2 must have the same dtype, but got Half and Float
2024-03-11 09:15:57,514 - INFO - =================== New Run Started: 2024-03-11 09:15:57 ===================
2024-03-11 09:15:57,515 - INFO - Training X_Reporto Started
2024-03-11 09:15:57,515 - INFO - DEVICE: cuda
2024-03-11 09:15:57,515 - INFO - OPERATION_MODE: 1
2024-03-11 09:15:57,515 - INFO - MODEL_STAGE: 3
2024-03-11 09:15:57,516 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:15:57,516 - INFO - TRAIN_RPN: False
2024-03-11 09:15:57,516 - INFO - TRAIN_ROI: False
2024-03-11 09:15:57,516 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:15:57,516 - INFO - RUN: 0
2024-03-11 09:15:57,517 - INFO - EPOCHS: 6
2024-03-11 09:15:57,517 - INFO - BATCH_SIZE: 1
2024-03-11 09:15:57,517 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:15:57,517 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:15:57,517 - INFO - LM_Batch_Size: 1
2024-03-11 09:15:57,517 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:15:57,518 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:15:57,518 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:15:57,518 - INFO - DEBUG: True
2024-03-11 09:15:57,518 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:15:57,519 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:15:57,519 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:15:57,519 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:15:57,519 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:15:57,520 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:15:57,520 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:15:57,520 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:15:57,520 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:15:57,520 - INFO - RECOVER: False
2024-03-11 09:15:57,521 - INFO - Folder 'models/0' already exists.
2024-03-11 09:15:57,521 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:15:57,522 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-15-57' created successfully.
2024-03-11 09:16:01,050 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:16:01,654 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:16:01,938 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:16:03,293 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:16:03,426 - INFO - Loading object_detector .....
2024-03-11 09:16:04,419 - INFO - All object_detector paramets are Frozen
2024-03-11 09:16:04,419 - INFO - Loading region_classifier .....
2024-03-11 09:16:04,426 - INFO - Loading abnormal_classifier .....
2024-03-11 09:16:04,916 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:16:05,009 - INFO - Train dataset loaded
2024-03-11 09:16:05,358 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:16:05,429 - INFO - Validation dataset loaded
2024-03-11 09:16:05,430 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:16:05,430 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:16:05,430 - INFO - Start Training
2024-03-11 09:17:08,937 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6880 selection_classifier_Loss: 1.0836 abnormal_classifier_Loss: 1.4033 LM_losses: 122.5782 total_Loss: 127.7531
2024-03-11 09:17:09,898 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7432 selection_classifier_Loss: 1.0842 abnormal_classifier_Loss: 1.4011 LM_losses: 253.0343 total_Loss: 258.2628
2024-03-11 09:17:10,854 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7665 selection_classifier_Loss: 1.1100 abnormal_classifier_Loss: 1.4497 LM_losses: 359.6403 total_Loss: 364.9664
2024-03-11 09:17:11,700 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7355 selection_classifier_Loss: 1.0816 abnormal_classifier_Loss: 1.3938 LM_losses: 470.5825 total_Loss: 475.7934
2024-03-11 09:17:12,543 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6867 selection_classifier_Loss: 1.0996 abnormal_classifier_Loss: 1.3136 LM_losses: 580.7539 total_Loss: 585.8538
2024-03-11 09:17:13,387 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7840 selection_classifier_Loss: 1.1031 abnormal_classifier_Loss: 1.3857 LM_losses: 700.0276 total_Loss: 705.3004
2024-03-11 09:17:14,241 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6669 selection_classifier_Loss: 1.0918 abnormal_classifier_Loss: 1.3913 LM_losses: 802.1160 total_Loss: 807.2661
2024-03-11 09:17:15,093 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7882 selection_classifier_Loss: 1.1077 abnormal_classifier_Loss: 1.3863 LM_losses: 930.5804 total_Loss: 935.8626
2024-03-11 09:17:15,949 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.6936 selection_classifier_Loss: 1.0879 abnormal_classifier_Loss: 1.3925 LM_losses: 1048.2412 total_Loss: 1053.4153
2024-03-11 09:17:16,807 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7873 selection_classifier_Loss: 1.0925 abnormal_classifier_Loss: 1.3917 LM_losses: 1170.4688 total_Loss: 1175.7402
2024-03-11 09:17:31,725 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:17:31,726 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:17:32,528 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5221 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: nan total_Loss: nan
2024-03-11 09:17:33,394 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4897 selection_classifier_Loss: 1.7379 abnormal_classifier_Loss: 4.9224 LM_losses: nan total_Loss: nan
2024-03-11 09:17:34,236 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5191 selection_classifier_Loss: 1.6899 abnormal_classifier_Loss: 5.0293 LM_losses: nan total_Loss: nan
2024-03-11 09:17:35,069 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5276 selection_classifier_Loss: 1.7429 abnormal_classifier_Loss: 4.9071 LM_losses: nan total_Loss: nan
2024-03-11 09:17:35,898 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5013 selection_classifier_Loss: 1.7159 abnormal_classifier_Loss: 4.8994 LM_losses: nan total_Loss: nan
2024-03-11 09:17:36,735 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5150 selection_classifier_Loss: 1.7276 abnormal_classifier_Loss: 4.8619 LM_losses: nan total_Loss: nan
2024-03-11 09:17:37,598 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5043 selection_classifier_Loss: 1.7509 abnormal_classifier_Loss: 4.9027 LM_losses: nan total_Loss: nan
2024-03-11 09:17:38,433 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5349 selection_classifier_Loss: 1.7353 abnormal_classifier_Loss: 4.8912 LM_losses: nan total_Loss: nan
2024-03-11 09:17:39,392 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5117 selection_classifier_Loss: 1.6283 abnormal_classifier_Loss: 4.9466 LM_losses: nan total_Loss: nan
2024-03-11 09:17:40,335 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5094 selection_classifier_Loss: 1.7274 abnormal_classifier_Loss: 4.8956 LM_losses: nan total_Loss: nan
2024-03-11 09:17:41,288 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5490 selection_classifier_Loss: 1.7458 abnormal_classifier_Loss: 4.9179 LM_losses: nan total_Loss: nan
2024-03-11 09:17:42,659 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.4817 selection_classifier_Loss: 1.7274 abnormal_classifier_Loss: 4.8956 LM_losses: nan total_Loss: nan
2024-03-11 09:19:52,231 - INFO - =================== New Run Started: 2024-03-11 09:19:52 ===================
2024-03-11 09:19:52,231 - INFO - Training X_Reporto Started
2024-03-11 09:19:52,231 - INFO - DEVICE: cuda
2024-03-11 09:19:52,232 - INFO - OPERATION_MODE: 1
2024-03-11 09:19:52,232 - INFO - MODEL_STAGE: 3
2024-03-11 09:19:52,232 - INFO - CONTINUE_TRAIN: False
2024-03-11 09:19:52,232 - INFO - TRAIN_RPN: False
2024-03-11 09:19:52,232 - INFO - TRAIN_ROI: False
2024-03-11 09:19:52,233 - INFO - FREEZE_OBJECT_DETECTOR: True
2024-03-11 09:19:52,233 - INFO - RUN: 0
2024-03-11 09:19:52,233 - INFO - EPOCHS: 6
2024-03-11 09:19:52,233 - INFO - BATCH_SIZE: 1
2024-03-11 09:19:52,233 - INFO - EFFECTIVE_BATCH_SIZE: 1
2024-03-11 09:19:52,234 - INFO - ACCUMULATION_STEPS: 1
2024-03-11 09:19:52,234 - INFO - LM_Batch_Size: 1
2024-03-11 09:19:52,234 - INFO - LEARNING_RATE: 0.001
2024-03-11 09:19:52,234 - INFO - SCHEDULAR_STEP_SIZE: 1
2024-03-11 09:19:52,234 - INFO - SCHEDULAR_GAMMA: 0.8
2024-03-11 09:19:52,235 - INFO - DEBUG: True
2024-03-11 09:19:52,235 - INFO - ABNORMAL_CLASSIFIER_POS_WEIGHT: 6.0
2024-03-11 09:19:52,235 - INFO - REGION_SELECTION_CLASSIFIER_POS_WEIGHT: 2.24
2024-03-11 09:19:52,235 - INFO - OBJECT_DETECTOR_WEIGHT: 1
2024-03-11 09:19:52,236 - INFO - ABNORMAL_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:19:52,236 - INFO - REGION_SELECTION_CLASSIFIER_WEIGHT: 2.5
2024-03-11 09:19:52,236 - INFO - training_csv_path: datasets/train.csv
2024-03-11 09:19:52,237 - INFO - validation_csv_path: datasets/valid-100.csv
2024-03-11 09:19:52,237 - INFO - PERIODIC_LOGGING: True
2024-03-11 09:19:52,237 - INFO - CHECKPOINT_EVERY_N: 400
2024-03-11 09:19:52,238 - INFO - RECOVER: False
2024-03-11 09:19:52,238 - INFO - Folder 'models/0' already exists.
2024-03-11 09:19:52,238 - INFO - Folder 'check_points/0' already exists.
2024-03-11 09:19:52,239 - INFO - Folder './tensor_boards/0/train_2024-03-11_09-19-52' created successfully.
2024-03-11 09:19:55,855 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2024-03-11 09:19:56,455 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:19:56,615 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/config.json HTTP/1.1" 200 0
2024-03-11 09:19:58,092 - DEBUG - https://huggingface.co:443 "HEAD /gpt2/resolve/main/generation_config.json HTTP/1.1" 200 0
2024-03-11 09:19:58,225 - INFO - Loading object_detector .....
2024-03-11 09:19:59,242 - INFO - All object_detector paramets are Frozen
2024-03-11 09:19:59,242 - INFO - Loading region_classifier .....
2024-03-11 09:19:59,249 - INFO - Loading abnormal_classifier .....
2024-03-11 09:19:59,726 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:19:59,811 - INFO - Train dataset loaded
2024-03-11 09:19:59,959 - DEBUG - https://huggingface.co:443 "HEAD /healx/gpt-2-pubmed-medium/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2024-03-11 09:20:00,026 - INFO - Validation dataset loaded
2024-03-11 09:20:00,027 - INFO - Training DataLoader Loaded Size: 200
2024-03-11 09:20:00,027 - INFO - Validation DataLoader Loaded Size: 42
2024-03-11 09:20:00,027 - INFO - Start Training
2024-03-11 09:21:03,143 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7896 selection_classifier_Loss: 1.2799 abnormal_classifier_Loss: 1.2483 LM_losses: 95.7208 total_Loss: 101.0386
2024-03-11 09:21:04,331 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7250 selection_classifier_Loss: 1.3786 abnormal_classifier_Loss: 1.3674 LM_losses: 195.8149 total_Loss: 201.2858
2024-03-11 09:21:05,474 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8059 selection_classifier_Loss: 1.2815 abnormal_classifier_Loss: 1.2519 LM_losses: 348.0638 total_Loss: 353.4031
2024-03-11 09:21:06,613 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7707 selection_classifier_Loss: 1.2797 abnormal_classifier_Loss: 1.2466 LM_losses: 443.5865 total_Loss: 448.8835
2024-03-11 09:21:07,757 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7882 selection_classifier_Loss: 1.2858 abnormal_classifier_Loss: 1.2984 LM_losses: 551.3655 total_Loss: 556.7379
2024-03-11 09:21:08,894 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7573 selection_classifier_Loss: 1.2888 abnormal_classifier_Loss: 1.2977 LM_losses: 640.8377 total_Loss: 646.1816
2024-03-11 09:21:10,028 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7450 selection_classifier_Loss: 1.2729 abnormal_classifier_Loss: 1.2494 LM_losses: 757.9335 total_Loss: 763.2008
2024-03-11 09:21:11,169 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7185 selection_classifier_Loss: 1.2645 abnormal_classifier_Loss: 1.2514 LM_losses: 853.3957 total_Loss: 858.6301
2024-03-11 09:21:12,323 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.8077 selection_classifier_Loss: 1.2866 abnormal_classifier_Loss: 1.3040 LM_losses: 956.0571 total_Loss: 961.4554
2024-03-11 09:21:13,464 - DEBUG - epoch: 1, Batch 1/200 object_detector_Loss: 2.7626 selection_classifier_Loss: 1.2645 abnormal_classifier_Loss: 1.2514 LM_losses: 1062.9019 total_Loss: 1068.1804
2024-03-11 09:21:29,628 - DEBUG - [Accumlative Learning after 1 steps ] Update Weights at  epoch: 1, Batch 1/200 
2024-03-11 09:21:29,628 - INFO - Epoch 1/6, Batch 1/200, Learning Rate: 0.0010000000
2024-03-11 09:21:30,963 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5956 selection_classifier_Loss: 1.7757 abnormal_classifier_Loss: 4.8854 LM_losses: nan total_Loss: nan
2024-03-11 09:21:32,126 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5207 selection_classifier_Loss: 1.7056 abnormal_classifier_Loss: 4.8783 LM_losses: nan total_Loss: nan
2024-03-11 09:21:33,278 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5167 selection_classifier_Loss: 1.7394 abnormal_classifier_Loss: 4.8390 LM_losses: nan total_Loss: nan
2024-03-11 09:21:34,438 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5088 selection_classifier_Loss: 1.7223 abnormal_classifier_Loss: 4.8416 LM_losses: nan total_Loss: nan
2024-03-11 09:21:35,602 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5618 selection_classifier_Loss: 1.7829 abnormal_classifier_Loss: 4.8809 LM_losses: nan total_Loss: nan
2024-03-11 09:21:36,774 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5083 selection_classifier_Loss: 1.7757 abnormal_classifier_Loss: 4.8854 LM_losses: nan total_Loss: nan
2024-03-11 09:21:37,932 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5391 selection_classifier_Loss: 1.7372 abnormal_classifier_Loss: 4.8566 LM_losses: nan total_Loss: nan
2024-03-11 09:21:39,124 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5399 selection_classifier_Loss: 1.7707 abnormal_classifier_Loss: 4.8928 LM_losses: nan total_Loss: nan
2024-03-11 09:21:40,338 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5320 selection_classifier_Loss: 1.7473 abnormal_classifier_Loss: 4.8809 LM_losses: nan total_Loss: nan
2024-03-11 09:21:41,618 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5319 selection_classifier_Loss: 1.7608 abnormal_classifier_Loss: 4.8060 LM_losses: nan total_Loss: nan
2024-03-11 09:21:42,982 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5094 selection_classifier_Loss: 1.7757 abnormal_classifier_Loss: 4.8854 LM_losses: nan total_Loss: nan
2024-03-11 09:21:44,267 - DEBUG - epoch: 1, Batch 2/200 object_detector_Loss: 2.5358 selection_classifier_Loss: 1.7656 abnormal_classifier_Loss: 4.8611 LM_losses: nan total_Loss: nan
2024-03-11 09:22:04,572 - DEBUG - [Accumlative Learning after 2 steps ] Update Weights at  epoch: 1, Batch 2/200 
2024-03-11 09:22:04,572 - INFO - Epoch 1/6, Batch 2/200, Learning Rate: 0.0010000000
2024-03-11 09:22:06,116 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 2.9935 selection_classifier_Loss: 2.0910 abnormal_classifier_Loss: 5.0972 LM_losses: nan total_Loss: nan
2024-03-11 09:22:07,288 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0865 selection_classifier_Loss: 2.0675 abnormal_classifier_Loss: 5.0807 LM_losses: nan total_Loss: nan
2024-03-11 09:22:08,433 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0605 selection_classifier_Loss: 2.1077 abnormal_classifier_Loss: 5.0578 LM_losses: nan total_Loss: nan
2024-03-11 09:22:09,623 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0378 selection_classifier_Loss: 2.0432 abnormal_classifier_Loss: 5.0041 LM_losses: nan total_Loss: nan
2024-03-11 09:22:10,839 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0554 selection_classifier_Loss: 2.0518 abnormal_classifier_Loss: 4.9351 LM_losses: nan total_Loss: nan
2024-03-11 09:22:12,062 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0585 selection_classifier_Loss: 2.0998 abnormal_classifier_Loss: 5.1083 LM_losses: nan total_Loss: nan
2024-03-11 09:22:13,242 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0602 selection_classifier_Loss: 2.1085 abnormal_classifier_Loss: 5.0590 LM_losses: nan total_Loss: nan
2024-03-11 09:22:14,441 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0781 selection_classifier_Loss: 2.0675 abnormal_classifier_Loss: 5.0807 LM_losses: nan total_Loss: nan
2024-03-11 09:22:15,642 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0417 selection_classifier_Loss: 2.0929 abnormal_classifier_Loss: 5.1477 LM_losses: nan total_Loss: nan
2024-03-11 09:22:16,845 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0353 selection_classifier_Loss: 2.0471 abnormal_classifier_Loss: 5.0389 LM_losses: nan total_Loss: nan
2024-03-11 09:22:18,041 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 2.9950 selection_classifier_Loss: 2.0915 abnormal_classifier_Loss: 5.0627 LM_losses: nan total_Loss: nan
2024-03-11 09:22:19,305 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0857 selection_classifier_Loss: 2.0471 abnormal_classifier_Loss: 5.0389 LM_losses: nan total_Loss: nan
2024-03-11 09:22:20,581 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.1280 selection_classifier_Loss: 2.0675 abnormal_classifier_Loss: 5.0807 LM_losses: nan total_Loss: nan
2024-03-11 09:22:22,250 - DEBUG - epoch: 1, Batch 3/200 object_detector_Loss: 3.0803 selection_classifier_Loss: 2.0277 abnormal_classifier_Loss: 4.9602 LM_losses: nan total_Loss: nan
2024-03-11 09:22:24,248 - ERROR - An error occurred
Traceback (most recent call last):
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 511, in <module>
    main()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 500, in main
    trainer.train()
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 170, in train
    Total_loss=self.language_model_forward_pass(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets=object_detector_targets,selection_classifier_targets=selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,LM_targets=LM_targets,epoch=epoch,batch_idx=batch_idx,loopLength=loopLength,LM_Batch_Size=LM_Batch_Size,validate_during_training=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\trainer\x_reporto_trainer.py", line 321, in language_model_forward_pass
    object_detector_losses,selection_classifier_losses,abnormal_binary_classifier_losses,LM_losses,stop= self.model(images=images,input_ids=input_ids,attention_mask=attention_mask,object_detector_targets= object_detector_targets,selection_classifier_targets= selection_classifier_targets,abnormal_classifier_targets=abnormal_classifier_targets,language_model_targets=LM_targets,batch=batch,index=i,delete = True,validate_during_training=validate_during_training)
                                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\x_reporto\models\x_reporto_v1.py", line 308, in forward
    object_detector_losses,object_detector_boxes,object_detector_detected_classes,object_detector_features = self.object_detector(images=images, targets=object_detector_targets)
                                                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\object_detector_factory.py", line 78, in forward
    object_detector_losses, object_detector_predictions =self.object_detector(images,targets)
                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\frccn_object_detector_v1.py", line 223, in forward
    detections  = self.roi_heads(features, proposals, images.image_sizes, targets)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Engineering\Fourth_Year\First_Term\Graduation\Graduation-Project\src\object_detector\models\roi.py", line 201, in forward
    box_roi_pool_feature = self.box_roi_pool(features, proposals, image_shapes)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\poolers.py", line 314, in forward
    return _multiscale_roi_align(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\poolers.py", line 175, in _multiscale_roi_align
    return roi_align(
           ^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torchvision\ops\roi_align.py", line 238, in roi_align
    return torch.ops.torchvision.roi_align(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\anaconda3\envs\pt\Lib\site-packages\torch\_ops.py", line 755, in __call__
    return self._op(*args, **(kwargs or {}))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 128.00 MiB. GPU 0 has a total capacity of 6.00 GiB of which 0 bytes is free. Of the allocated memory 5.03 GiB is allocated by PyTorch, and 227.68 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
